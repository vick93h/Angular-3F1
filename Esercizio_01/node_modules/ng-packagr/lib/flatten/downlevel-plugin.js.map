{"version":3,"file":"downlevel-plugin.js","sourceRoot":"","sources":["../../../src/lib/flatten/downlevel-plugin.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAA6B;AAE7B,2CAA8G;AAE9G,kDAAoC;AAEpC;;GAEG;AACH,MAAM,gBAAgB,GAAoB;IACxC,MAAM,EAAE,yBAAY,CAAC,MAAM;IAC3B,MAAM,EAAE,uBAAU,CAAC,MAAM;IACzB,OAAO,EAAE,IAAI;IACb,SAAS,EAAE,IAAI;IACf,aAAa,EAAE,IAAI;IACnB,kBAAkB,EAAE,IAAI;IACxB,gBAAgB,EAAE,iCAAoB,CAAC,OAAO;CAC/C,CAAC;AAEF;;GAEG;AACH,SAAgB,0BAA0B;IACxC,OAAO;QACL,IAAI,EAAE,cAAc;QACpB,SAAS,EAAE,UAAU,IAAI,EAAE,EAAE;YAC3B,GAAG,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;YACvB,MAAM,eAAe,GAAoB;gBACvC,GAAG,gBAAgB;gBACnB,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;aAC1B,CAAC;YAEF,MAAM,EAAE,UAAU,EAAE,aAAa,EAAE,GAAG,IAAA,4BAAe,EAAC,IAAI,EAAE;gBAC1D,eAAe;aAChB,CAAC,CAAC;YAEH,OAAO;gBACL,IAAI,EAAE,UAAU;gBAChB,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC;aAC/B,CAAC;QACJ,CAAC;KACF,CAAC;AACJ,CAAC;AApBD,gEAoBC","sourcesContent":["import * as path from 'path';\nimport { Plugin } from 'rollup';\nimport { CompilerOptions, ModuleKind, ModuleResolutionKind, ScriptTarget, transpileModule } from 'typescript';\n\nimport * as log from '../utils/log';\n\n/**\n * Base `tsc` `CompilerOptions` shared among various downleveling methods.\n */\nconst COMPILER_OPTIONS: CompilerOptions = {\n  target: ScriptTarget.ES2015,\n  module: ModuleKind.ESNext,\n  allowJs: true,\n  sourceMap: true,\n  importHelpers: true,\n  downlevelIteration: true,\n  moduleResolution: ModuleResolutionKind.Classic,\n};\n\n/**\n * Downlevels a .js file from `ES2015` to `ES2015`. Internally, uses `tsc`.\n */\nexport function downlevelCodeWithTscPlugin(): Plugin {\n  return {\n    name: 'downlevel-ts',\n    transform: function (code, id) {\n      log.debug(`tsc ${id}`);\n      const compilerOptions: CompilerOptions = {\n        ...COMPILER_OPTIONS,\n        mapRoot: path.dirname(id),\n      };\n\n      const { outputText, sourceMapText } = transpileModule(code, {\n        compilerOptions,\n      });\n\n      return {\n        code: outputText,\n        map: JSON.parse(sourceMapText),\n      };\n    },\n  };\n}\n"]}